<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LlamaIndex Knowledge Graph</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Knowledge Graph Generator</h1>
            <p class="subtitle">Build and query knowledge graphs from your documents</p>
        </header>

        <div class="tabs">
            <button class="tab-button active" data-tab="s3">S3 Configuration</button>
            <button class="tab-button" data-tab="neo4j">Neo4j Pipeline</button>
            <button class="tab-button" data-tab="opensearch">OpenSearch Pipeline</button>
        </div>

        <div class="content">
            <!-- S3 Configuration Tab -->
            <div class="tab-content active" id="s3-tab">
                <h2>S3 Configuration</h2>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="use_s3">
                        Enable S3 Integration
                    </label>
                </div>

                <div class="form-group">
                    <label for="aws_region">AWS Region</label>
                    <select id="aws_region">
                        <option value="us-east-1">us-east-1</option>
                        <option value="us-west-2">us-west-2</option>
                        <option value="eu-west-1">eu-west-1</option>
                        <option value="ap-southeast-1">ap-southeast-1</option>
                        <option value="ap-south-1">ap-south-1</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="input_bucket">Input S3 Bucket</label>
                    <input type="text" id="input_bucket" placeholder="my-documents-bucket">
                    <small>S3 bucket containing JSON documents</small>
                </div>

                <div class="form-group">
                    <label for="input_prefix">Input S3 Prefix</label>
                    <input type="text" id="input_prefix" value="docs/" placeholder="docs/">
                    <small>Prefix/folder path for input files</small>
                </div>

                <div class="form-group">
                    <label for="output_bucket">Output S3 Bucket</label>
                    <input type="text" id="output_bucket" placeholder="my-output-bucket">
                    <small>S3 bucket for graph exports (future)</small>
                </div>

                <div class="form-group">
                    <label for="output_prefix">Output S3 Prefix</label>
                    <input type="text" id="output_prefix" value="knowledge_graph/" placeholder="knowledge_graph/">
                    <small>Prefix/folder path for output files</small>
                </div>

                <div class="form-group">
                    <label for="max_files">Maximum Files to Process</label>
                    <input type="number" id="max_files" value="0" min="0" placeholder="0">
                    <small>Total files to process from S3 (0 = process all files)</small>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="testS3Connection()">Test S3 Connection</button>
                    <button class="btn btn-primary" onclick="saveS3Configuration()">Save S3 Configuration</button>
                </div>

                <div id="s3-status" class="status-box" style="display: none;"></div>

                <div style="margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 4px; border-left: 4px solid #2196f3;">
                    <strong>üí° Tip:</strong> S3 configuration is saved independently without reinitializing Neo4j or LLM connections.
                </div>
            </div>

            <!-- Neo4j Pipeline Tab with Sub-tabs -->
            <div class="tab-content" id="neo4j-tab">
                <h2>Neo4j Pipeline Configuration</h2>

                <!-- Neo4j Sub-tabs -->
                <div class="sub-tabs">
                    <button class="sub-tab-button active" data-subtab="neo4j-connection">Connection & Pipeline</button>
                    <button class="sub-tab-button" data-subtab="neo4j-llm">LLM/Embedding Gateway</button>
                    <button class="sub-tab-button" data-subtab="neo4j-prompts">Extraction Prompts</button>
                </div>

                <!-- Sub-tab: Connection & Pipeline -->
                <div class="sub-tab-content active" id="neo4j-connection">
                    <h3>Neo4j Database Connection</h3>

                <div class="form-group">
                    <label for="neo4j_uri">Neo4j URI</label>
                    <input type="text" id="neo4j_uri" value="bolt://localhost:7687" placeholder="bolt://localhost:7687">
                    <small>Neo4j connection URI (bolt:// or neo4j://)</small>
                </div>

                <div class="form-group">
                    <label for="neo4j_username">Username</label>
                    <input type="text" id="neo4j_username" value="neo4j">
                </div>

                <div class="form-group">
                    <label for="neo4j_password">Password</label>
                    <input type="password" id="neo4j_password" value="password123">
                </div>

                <div class="form-group">
                    <label for="neo4j_database">Database Name</label>
                    <input type="text" id="neo4j_database" value="neo4j">
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="testNeo4jConnection()">Test Connection</button>
                    <a href="http://localhost:7474" target="_blank">
                        <button class="btn btn-secondary" type="button">Open Neo4j Browser</button>
                    </a>
                    <button class="btn btn-primary" onclick="saveConfiguration()">Save Configuration</button>
                </div>

                <h3 style="margin-top: 30px;">Vector Indexes</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    üí° Vector indexes enable semantic search on entities and chunks. Required for MCP GraphRAG server.
                </p>

                <div class="form-group">
                    <label for="entity_dimension">Entity Embedding Dimension (optional)</label>
                    <input type="number" id="entity_dimension" placeholder="Auto-detect from existing embeddings" min="1" max="4096">
                    <small>Dimension for entity vector index (leave empty to auto-detect). Common values: 768, 1024, 1536, 3072</small>
                </div>

                <div class="form-group">
                    <label for="chunk_dimension">Chunk Embedding Dimension (optional)</label>
                    <input type="number" id="chunk_dimension" placeholder="Auto-detect from existing embeddings" min="1" max="4096">
                    <small>Dimension for chunk vector index (leave empty to auto-detect). Common values: 768, 1024, 1536, 3072</small>
                </div>

                <div id="vector-index-status" class="status-box" style="display: none;"></div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="checkVectorIndexes()">üîç Check Vector Indexes</button>
                    <button class="btn btn-primary" onclick="createVectorIndexes()">‚ú® Create/Update Indexes</button>
                </div>

                <!-- Processing Configuration Section -->
                <h3 style="margin-top: 40px;">Processing Configuration</h3>

                <div class="form-group">
                    <label for="docs_folder">Documents Folder</label>
                    <input type="text" id="docs_folder" value="sample_docs" placeholder="sample_docs">
                    <small>Local folder for JSON documents</small>
                </div>

                <div class="form-group">
                    <label for="chunk_size">Chunk Size</label>
                    <input type="number" id="chunk_size" value="512" min="128" max="2048" placeholder="512">
                    <small>Maximum characters per text chunk</small>
                </div>

                <div class="form-group">
                    <label for="chunk_overlap">Chunk Overlap</label>
                    <input type="number" id="chunk_overlap" value="50" min="0" max="500" placeholder="50">
                    <small>Overlap between consecutive chunks</small>
                </div>

                <div class="form-group">
                    <label for="max_triplets_per_chunk">Max Triplets per Chunk</label>
                    <input type="number" id="max_triplets_per_chunk" value="10" min="1" max="50" placeholder="10">
                    <small>Maximum relationships extracted per chunk</small>
                </div>

                <div class="form-group">
                    <label for="prompt_template">Prompt Template</label>
                    <select id="prompt_template">
                        <option value="default">Default - Basic extraction</option>
                        <option value="enhanced">Enhanced - More detailed instructions</option>
                        <option value="business">Business - Organizational data</option>
                        <option value="research">Research - Scientific papers</option>
                    </select>
                    <small>Pre-configured prompt template for extraction (customize in Extraction Prompts tab)</small>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="store_chunk_embeddings" checked>
                        Store Chunk Embeddings
                    </label>
                    <small>Generate and store embeddings for text chunks (enables DOC_SEARCH mode). Disabling this speeds up processing by ~30% but limits search to entity-based (LOCAL_SEARCH) only.</small>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="store_entity_embeddings" checked>
                        Store Entity Embeddings
                    </label>
                    <small>Generate and store embeddings for entities (required for MCP server local_search). Entity embeddings enable semantic search over knowledge graph entities for better retrieval quality.</small>
                </div>

                <h4 style="margin-top: 25px;">JSON Schema Configuration</h4>

                <div class="form-group">
                    <label for="document_id_field">Document ID Field</label>
                    <input type="text" id="document_id_field" value="id" placeholder="id">
                    <small>JSON field to use as unique document identifier</small>
                </div>

                <div class="form-group">
                    <label for="content_fields">Content Fields (comma-separated)</label>
                    <input type="text" id="content_fields" value="content" placeholder="content,description,text">
                    <small>JSON fields to extract and process for knowledge graph building</small>
                </div>

                <div class="form-group">
                    <label for="metadata_fields">Metadata Fields (comma-separated)</label>
                    <input type="text" id="metadata_fields" value="subject,author,category,tags" placeholder="subject,author,category,tags">
                    <small>JSON fields to preserve as metadata (not processed for graph)</small>
                </div>

                <!-- Pipeline Execution Section -->
                <h3 style="margin-top: 40px;">Run Knowledge Graph Pipeline</h3>

                <div class="pipeline-status">
                    <div id="pipeline-status" class="status-box status-idle">
                        <strong>Status:</strong> <span id="status-text">Idle</span><br>
                        <span id="status-message"></span>
                    </div>
                </div>

                <h4 style="margin-top: 20px;">Build Options</h4>

                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    üí° Pipeline will process documents from S3 (configured in S3 Configuration tab)
                </p>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="clear_before_build">
                        Clear existing graph data before building
                    </label>
                    <small>‚ö†Ô∏è This will delete all existing nodes and relationships (vector indexes are preserved)</small>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="buildGraph()">‚ñ∂ Build Knowledge Graph</button>
                    <button class="btn btn-secondary" onclick="refreshStatus()">üîÑ Refresh Status</button>
                </div>

                <h4 style="margin-top: 25px;">Graph Statistics</h4>
                <div id="graph-stats"></div>

                <div style="margin-top: 25px; padding: 12px; background: #e8f5e9; border-radius: 4px; border-left: 4px solid #4caf50;">
                    <strong>üí° Quick Actions:</strong><br>
                    <a href="/docs" target="_blank" style="color: #2196f3;">API Documentation</a> |
                    <a href="http://localhost:7474" target="_blank" style="color: #2196f3;">Neo4j Browser</a>
                </div>
                </div>
                <!-- End of Connection & Pipeline sub-tab -->

                <!-- Sub-tab: LLM/Embedding Gateway -->
                <div class="sub-tab-content" id="neo4j-llm">
                    <h3>LLM Gateway</h3>

                    <div class="form-group">
                        <label for="llm_model_name">LLM Model Name</label>
                        <input type="text" id="llm_model_name" value="llama3.2:latest" placeholder="llama3.2:latest">
                        <small>Model name for entity/relationship extraction</small>
                    </div>

                    <div class="form-group">
                        <label for="llm_api_url">LLM API URL</label>
                        <input type="text" id="llm_api_url" value="http://localhost:11434/api/generate" placeholder="http://localhost:11434/api/generate">
                        <small>Full API endpoint URL for LLM completions</small>
                    </div>

                    <div class="form-group">
                        <label for="llm_api_key">LLM API Key</label>
                        <input type="password" id="llm_api_key" placeholder="Optional API key">
                        <small>API key for authentication (leave empty if not required)</small>
                    </div>

                    <div class="form-group">
                        <label for="llm_response_format">LLM Response Format</label>
                        <select id="llm_response_format">
                            <option value="ollama" selected>Ollama</option>
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="custom">Custom</option>
                        </select>
                        <small>Response format from your LLM gateway</small>
                    </div>

                    <h3 style="margin-top: 30px;">Embedding Gateway</h3>

                    <div class="form-group">
                        <label for="embedding_model_name">Embedding Model Name</label>
                        <input type="text" id="embedding_model_name" value="nomic-embed-text" placeholder="nomic-embed-text">
                        <small>Model name for vector embeddings</small>
                    </div>

                    <div class="form-group">
                        <label for="embedding_api_url">Embedding API URL</label>
                        <input type="text" id="embedding_api_url" value="http://localhost:11434/api/embeddings" placeholder="http://localhost:11434/api/embeddings">
                        <small>Full API endpoint URL for embeddings</small>
                    </div>

                    <div class="form-group">
                        <label for="embedding_api_key">Embedding API Key</label>
                        <input type="password" id="embedding_api_key" placeholder="Optional API key">
                        <small>API key for authentication (leave empty if not required)</small>
                    </div>

                    <div class="form-group">
                        <label for="embedding_response_format">Embedding Response Format</label>
                        <select id="embedding_response_format">
                            <option value="ollama" selected>Ollama</option>
                            <option value="openai">OpenAI</option>
                            <option value="custom">Custom</option>
                        </select>
                        <small>Response format from your embedding gateway</small>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-primary" onclick="saveConfiguration()">Save Configuration</button>
                    </div>
                </div>

                <!-- Sub-tab: Extraction Prompts -->
                <div class="sub-tab-content" id="neo4j-prompts">
                    <!-- This content will be moved from prompts-tab -->
                </div>

            </div>
            <!-- End of Neo4j Pipeline Tab -->

            <!-- OpenSearch Configuration Tab -->
            <div class="tab-content" id="opensearch-tab">
                <h2>OpenSearch Configuration</h2>

                <div class="form-group">
                    <label for="opensearch_host">OpenSearch Host</label>
                    <input type="text" id="opensearch_host" value="localhost" placeholder="localhost">
                    <small>OpenSearch server hostname</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_port">OpenSearch Port</label>
                    <input type="number" id="opensearch_port" value="9200" placeholder="9200">
                    <small>OpenSearch server port (default: 9200)</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_username">Username (optional)</label>
                    <input type="text" id="opensearch_username" placeholder="admin">
                    <small>Leave empty if authentication is not required</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_password">Password (optional)</label>
                    <input type="password" id="opensearch_password" placeholder="admin">
                    <small>Leave empty if authentication is not required</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_index_name">Index Name</label>
                    <input type="text" id="opensearch_index_name" value="documents" placeholder="documents">
                    <small>Name of the OpenSearch index to create/use</small>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="opensearch_use_ssl">
                        Use SSL/TLS
                    </label>
                    <small>Enable SSL/TLS for secure connections</small>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="testOpenSearchConnection()">Test Connection</button>
                    <button class="btn btn-primary" onclick="saveOpenSearchConfiguration()">Save Configuration</button>
                </div>

                <div id="opensearch-status" class="status-box" style="display: none;"></div>

                <h3 style="margin-top: 30px;">Processing Configuration</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    ‚öôÔ∏è Configure how documents are chunked and indexed
                </p>

                <div class="form-group">
                    <label for="opensearch_chunk_size">Chunk Size (characters)</label>
                    <input type="number" id="opensearch_chunk_size" value="512" min="128" max="4096" placeholder="512">
                    <small>Maximum characters per text chunk (default: 512)</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_chunk_overlap">Chunk Overlap (characters)</label>
                    <input type="number" id="opensearch_chunk_overlap" value="50" min="0" max="500" placeholder="50">
                    <small>Overlap between consecutive chunks to preserve context (default: 50)</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_embedding_dimension">Embedding Dimension</label>
                    <input type="number" id="opensearch_embedding_dimension" value="768" min="128" max="4096" placeholder="768">
                    <small>Vector dimension for embeddings (default: 768 for nomic-embed-text)</small>
                </div>

                <h3 style="margin-top: 30px;">Embedding Service Configuration</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    üîÆ Configure the embedding service for generating vector embeddings
                </p>

                <div class="form-group">
                    <label for="opensearch_embedding_model">Embedding Model Name</label>
                    <input type="text" id="opensearch_embedding_model" value="nomic-embed-text" placeholder="nomic-embed-text">
                    <small>Name of the embedding model to use</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_embedding_api_url">Embedding API URL</label>
                    <input type="text" id="opensearch_embedding_api_url" value="http://localhost:11434/api/embeddings" placeholder="http://localhost:11434/api/embeddings">
                    <small>Full URL to the embedding service endpoint</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_embedding_api_key">Embedding API Key (optional)</label>
                    <input type="password" id="opensearch_embedding_api_key" placeholder="">
                    <small>API key for authentication (leave empty if not required)</small>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="opensearch_embedding_use_bearer">
                        Use Bearer Token Authentication
                    </label>
                    <small>Enable if API key should be sent as Bearer token in Authorization header</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_embedding_response_format">Response Format</label>
                    <select id="opensearch_embedding_response_format">
                        <option value="ollama">Ollama</option>
                        <option value="openai">OpenAI</option>
                        <option value="custom">Custom</option>
                    </select>
                    <small>Response format from the embedding API</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_embedding_custom_parser">Custom Response Parser (optional)</label>
                    <input type="text" id="opensearch_embedding_custom_parser" placeholder="data.embeddings">
                    <small>JSON path for custom response parsing (e.g., "data.embeddings")</small>
                </div>

                <h3 style="margin-top: 30px;">JSON Schema Configuration</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    üìã Configure which fields from your JSON documents to index
                </p>

                <div class="form-group">
                    <label for="opensearch_document_id_field">Document ID Field</label>
                    <input type="text" id="opensearch_document_id_field" value="id" placeholder="id">
                    <small>JSON field to use as unique document identifier</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_content_fields">Content Fields (comma-separated)</label>
                    <input type="text" id="opensearch_content_fields" value="content" placeholder="content,description,text">
                    <small>JSON fields to extract and index for full-text search</small>
                </div>

                <div class="form-group">
                    <label for="opensearch_metadata_fields">Metadata Fields (comma-separated)</label>
                    <input type="text" id="opensearch_metadata_fields" value="subject,author,category,tags" placeholder="subject,author,category,tags">
                    <small>JSON fields to preserve as metadata (searchable but not chunked)</small>
                </div>

                <h3 style="margin-top: 30px;">Index Mapping</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    üìÑ Specify the mapping file that controls index settings and field mappings
                </p>

                <div class="form-group">
                    <label for="opensearch_mapping_file">Mapping File Path</label>
                    <input type="text" id="opensearch_mapping_file" value="events_mapping.json" placeholder="events_mapping.json">
                    <small>Path to JSON file containing OpenSearch index settings and mappings (relative to project directory). The file controls all index configuration including analyzers, tokenizers, and field types.</small>
                </div>

                <div class="form-group">
                    <label>Mapping File Management</label>
                    <div style="display: flex; gap: 10px; align-items: center; margin-top: 8px;">
                        <input type="file" id="mapping_file_upload" accept=".json" style="display: none;" onchange="handleMappingFileUpload(event)">
                        <button class="btn btn-secondary" onclick="document.getElementById('mapping_file_upload').click()">üì§ Upload Mapping File</button>
                        <button class="btn btn-secondary" onclick="downloadMappingFile()">üì• Download Current Mapping</button>
                    </div>
                    <small style="display: block; margin-top: 8px;">Upload a new mapping JSON file to replace the existing one. Changes apply when index is recreated (use "Clear existing data" option).</small>
                </div>

                <div id="mapping-upload-status" class="status-box" style="display: none; margin-top: 15px;"></div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveOpenSearchConfiguration()">üíæ Save Configuration</button>
                </div>

                <h3 style="margin-top: 30px;">Index Management</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    üí° Manage OpenSearch index for hybrid search (TF-IDF + Vector embeddings)
                </p>

                <div id="opensearch-index-status" class="status-box" style="display: none;"></div>

                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="opensearch_clear_first" style="width: auto; cursor: pointer;">
                        <span style="font-size: 14px; color: #666;">
                            Clear existing data before loading (force reload all documents)
                        </span>
                    </label>
                </div>

                <div class="button-group">
                    <button class="btn btn-danger" onclick="deleteOpenSearchIndex()">üóëÔ∏è Delete Index</button>
                    <button class="btn btn-primary" onclick="buildOpenSearchIndex()">üìù Load Data to OpenSearch</button>
                </div>
            </div>

            <!-- LLM/Embedding Gateway Configuration Tab -->
            <div class="tab-content" id="gateway-tab">
                <h2>LLM/Embedding Gateway Configuration</h2>

                <h3>LLM Gateway</h3>

                <div class="form-group">
                    <label for="llm_model_name">LLM Model Name</label>
                    <input type="text" id="llm_model_name" value="llama3.2:latest" placeholder="llama3.2:latest">
                    <small>Model name for entity/relationship extraction</small>
                </div>

                <div class="form-group">
                    <label for="llm_api_url">LLM API URL</label>
                    <input type="text" id="llm_api_url" value="http://localhost:11434/api/generate" placeholder="http://localhost:11434/api/generate">
                    <small>Full API endpoint URL for LLM completions</small>
                </div>

                <div class="form-group">
                    <label for="llm_api_key">LLM API Key</label>
                    <input type="password" id="llm_api_key" placeholder="Optional API key">
                    <small>API key for authentication (leave empty if not required)</small>
                </div>

                <div class="form-group">
                    <label for="llm_response_format">LLM Response Format</label>
                    <select id="llm_response_format">
                        <option value="ollama" selected>Ollama</option>
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                        <option value="custom">Custom</option>
                    </select>
                    <small>Response format from your LLM gateway</small>
                </div>

                <h3 style="margin-top: 30px;">Embedding Gateway</h3>

                <div class="form-group">
                    <label for="embedding_model_name">Embedding Model Name</label>
                    <input type="text" id="embedding_model_name" value="nomic-embed-text" placeholder="nomic-embed-text">
                    <small>Model name for vector embeddings</small>
                </div>

                <div class="form-group">
                    <label for="embedding_api_url">Embedding API URL</label>
                    <input type="text" id="embedding_api_url" value="http://localhost:11434/api/embeddings" placeholder="http://localhost:11434/api/embeddings">
                    <small>Full API endpoint URL for embeddings</small>
                </div>

                <div class="form-group">
                    <label for="embedding_api_key">Embedding API Key</label>
                    <input type="password" id="embedding_api_key" placeholder="Optional API key">
                    <small>API key for authentication (leave empty if not required)</small>
                </div>

                <div class="form-group">
                    <label for="embedding_response_format">Embedding Response Format</label>
                    <select id="embedding_response_format">
                        <option value="ollama" selected>Ollama</option>
                        <option value="openai">OpenAI</option>
                        <option value="custom">Custom</option>
                    </select>
                    <small>Response format from your embedding gateway</small>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveConfiguration()">Save Configuration</button>
                </div>
            </div>

            <!-- Extraction Prompts Tab -->
            <div class="tab-content" id="prompts-tab">
                <h2 style="text-align: center; margin-bottom: 10px;">Extraction Prompt Configuration</h2>

                <p style="max-width: 1200px; margin: 0 auto 20px auto; color: #666; font-size: 13px; text-align: center;">
                    Configure how the AI extracts nodes and relationships from text.<br>
                    <strong style="color: #d9534f;">‚ö†Ô∏è IMPORTANT:</strong> For best results, <strong>keep Custom Prompt EMPTY</strong> and use the template selector in Processing tab.<br>
                    Only use Custom Prompt if you need advanced customization.
                </p>

                <div class="form-group prompt-container">
                    <label for="custom_prompt" style="text-align: left; margin-bottom: 8px; font-size: 14px; font-weight: 600;">
                        Custom Extraction Prompt <span style="color: #d9534f; font-weight: 400;">(Leave Empty - Recommended)</span>
                    </label>
                    <textarea
                        id="custom_prompt"
                        rows="20"
                        placeholder="‚ö†Ô∏è RECOMMENDED: Leave this field EMPTY

The template system works better for extraction. Use the 'Prompt Template' dropdown in the Processing tab instead.

Only fill this if you need advanced customization beyond the provided templates.

If you do customize, use these variables:
- {max_knowledge_triplets} - Max number of triplets to extract
- {text} - The input text to process

Format: (subject, predicate, object)"
                        style="width: 100%; padding: 12px; font-family: 'Courier New', monospace; font-size: 13px; border: 1px solid #ddd; border-radius: 4px; resize: vertical; line-height: 1.5; background-color: #fffbf0;"
                    ></textarea>
                    <small style="margin-top: 8px; display: block; color: #d9534f;">
                        <strong>‚ö†Ô∏è WARNING:</strong> Copying template text here may cause extraction issues. Use template selector instead.<br>
                        <strong>Variables:</strong> <code>{max_knowledge_triplets}</code> and <code>{text}</code><br>
                        <strong>Reference:</strong> See <code>kg_prompts.py</code> for template examples.
                    </small>
                </div>

                <div class="button-group" style="max-width: 1200px; margin: 0 auto; justify-content: center;">
                    <button class="btn btn-primary" onclick="loadCurrentPrompt()">Load Current Prompt</button>
                    <button class="btn btn-secondary" onclick="loadDefaultPrompt()">Load Default Template</button>
                    <button class="btn btn-secondary" onclick="clearCustomPrompt()">Clear Custom Prompt</button>
                    <button class="btn btn-primary" onclick="saveConfiguration()">Save Configuration</button>
                </div>
            </div>

        </div>
    </div>

    <script src="/static/app.js?v=3"></script>
    <script src="/static/opensearch.js"></script>
</body>
</html>
