  How it should work:

  precision_threshold: 40000

  If unique values < 40000 → Exact counting (no HLL)
  If unique values >= 40000 → HLL approximation

  Your data: ~5500 unique rids (well below 40000)

  OpenSearch SHOULD use exact counting, not HLL.

  ---
  Let's test directly on OpenSearch (bypass MCP server):

  Run this raw query to see unprocessed results:

  {
    "size": 0,
    "query": {
      "range": {
        "event_date": {
          "gte": "2024-01-01",
          "lt": "2025-01-01"
        }
      }
    },
    "aggs": {
      "total_cardinality": {
        "cardinality": {
          "field": "rid",
          "precision_threshold": 40000
        }
      },
      "by_quarter": {
        "date_histogram": {
          "field": "event_date",
          "calendar_interval": "quarter",
          "time_zone": "UTC"
        },
        "aggs": {
          "quarter_cardinality": {
            "cardinality": {
              "field": "rid",
              "precision_threshold": 40000
            }
          }
        }
      }
    }
  }

  ---
  Share the raw response:

  total_cardinality.value = ?
  Q1 quarter_cardinality.value = ?
  Q2 quarter_cardinality.value = ?
  Q3 quarter_cardinality.value = ?
  Q4 quarter_cardinality.value = ?